{%- comment -%}
------------------------------------------------------------------------------------------------------------------------
NOTE TO DEVELOPERS: welcome to Impact theme! We hope that you will enjoy editing this theme as much as we did for
  developing it. We have put a lot of work to make this theme as developer friendly as possible by offering you
  hooks to integrate into critical parts of the theme. You will find the complete technical documentation (including
  all events, dependencies...) in the "documentation.txt" file, located in the Assets folder.
------------------------------------------------------------------------------------------------------------------------
{%- endcomment -%}

<!doctype html>

<html class="no-js" lang="{{ request.locale.iso_code }}" dir="{% render 'direction' %}">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, height=device-height, minimum-scale=1.0, maximum-scale=1.0">
    <meta name="theme-color" content="{{ settings.header_background }}">

    <title>{% if page_title == blank %}{{ shop.name }}{% else %}{{ page_title }}{% if current_page != 1 %} &ndash; {{ 'general.page' | t: page: current_page }}{% endif %}{% endif %}</title>

    {%- if page_description -%}
      <meta name="description" content="{{ page_description | escape }}">
    {%- endif -%}

    <link rel="canonical" href="{{ canonical_url }}">

    {%- if settings.favicon -%}
      <link rel="shortcut icon" href="{{ settings.favicon | image_url: width: 96 }}">
      <link rel="apple-touch-icon" href="{{ settings.favicon | image_url: width: 180 }}">
    {%- endif -%}

    {%- comment -%}Few prefetch to increase performance on commonly used third-parties{%- endcomment -%}
    <link rel="preconnect" href="https://cdn.shopify.com">
    <link rel="preconnect" href="https://fonts.shopifycdn.com" crossorigin>
    <link rel="dns-prefetch" href="https://productreviews.shopifycdn.com">

    {%- unless settings.heading_font.system? -%}
      <link rel="preload" href="{{ settings.heading_font | font_url }}" as="font" type="font/woff2" crossorigin>
    {%- endunless -%}

    {%- unless settings.text_font.system? -%}
      <link rel="preload" href="{{ settings.text_font | font_url }}" as="font" type="font/woff2" crossorigin>
    {%- endunless -%}

    {%- render 'social-meta-tags' -%}
    {%- render 'microdata-schema' -%}
    {%- render 'css-variables' -%}
    {%- render 'js-variables' -%}

    <script type="module" src="{{ 'vendor.min.js' | asset_url }}"></script>
    <script type="module" src="{{ 'theme.js' | asset_url }}"></script>
    <script type="module" src="{{ 'sections.js' | asset_url }}"></script>

    {{ content_for_header }}

    {{- 'theme.css' | asset_url | stylesheet_tag: preload: true -}}
    <style>
  .shopify-section--main-product {
    padding-bottom: 0 !important;
    margin-bottom: -40px !important;
  }
</style>
  </head>

  <body class="{% if settings.show_page_transition %}page-transition{% endif %} {% if settings.zoom_image_on_hover %}zoom-image--enabled{% endif %}">
    {%- render 'shadow-dom-templates' -%}

    <a href="#main" class="skip-to-content sr-only">{{ 'general.accessibility.skip_to_content' | t }}</a>

    {%- if request.page_type != 'password' -%}
      {%- sections 'header-group' -%}
      {%- sections 'overlay-group' -%}

      {%- if settings.cart_type == 'popover' -%}
        <cart-notification-drawer open-from="bottom" class="quick-buy-drawer drawer"></cart-notification-drawer>
      {%- endif -%}
    {%- endif -%}

    {%- if request.page_type == 'customers/account' or request.page_type == 'customers/order' or request.page_type == 'customers/addresses' -%}
      {%- section 'account-banner' -%}
    {%- endif -%}

    <main role="main" id="main" class="anchor">
      {{ content_for_layout }}

      {%- comment -%}
      IMPLEMENTATION NOTE: due to the very complex logic of margin/padding collapsing in Impact, the footer group is
      added into the main element to ensure that dynamic sections added into the footer group are properly laid out.
      {%- endcomment -%}
      {%- if request.page_type != 'password' -%}
        {%- sections 'footer-group' -%}
      {%- endif -%}
    </main>
    {%- comment -%} WhatsApp Chat Widget {%- endcomment -%}
    {% render 'whatsapp-widget' %}

    <style>
  /* Change top area color to match announcement bar on mobile */
@media screen and (max-width: 1000px) {
  body {
    background-color: #7900FD;
  }
  
  /* Ensure header group has same background */
  .shopify-section-group-header-group {
    background-color: #7900FD;
  }
  
  /* Remove any top padding/margin that might show white */
  body, html {
    margin: 0;
    padding: 0;
  }
}
  /* Sticky Bottom Navigation - Mobile Only */
  @media screen and (max-width: 768px) {
    /* Force viewport to include bottom bar area */
    html {
      height: -webkit-fill-available;
      height: 100%;
    }
    
    body {
      min-height: -webkit-fill-available;
      min-height: 100vh;
      position: relative;
    }
    
    .mobile-bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      width: 100%;
      background: #7900FD;
      box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.2);
      display: flex;
      justify-content: space-around;
      padding: 8px 0;
      z-index: 1000;
      /* Prevent layout shifts */
      transform: translateZ(0);
      backface-visibility: hidden;
      -webkit-backface-visibility: hidden;
      /* Force GPU acceleration */
      will-change: transform;
      /* Prevent iOS Safari from moving it */
      touch-action: manipulation;
      
      /* FIX FOR TRANSPARENT GAP - Extended padding */
      padding-bottom: max(8px, env(safe-area-inset-bottom, 0px));
      padding-bottom: calc(8px + env(safe-area-inset-bottom, 0px));
      min-height: calc(65px + env(safe-area-inset-bottom, 0px));
      
      /* Prevent any transparent areas */
      -webkit-transform: translate3d(0, 0, 0);
      isolation: isolate;
    }
    
    /* Only cover the gap BELOW navbar, not above */
    .mobile-bottom-nav::after {
      content: '';
      position: absolute;
      bottom: -80px;
      left: 0;
      right: 0;
      height: 80px;
      background: #7900FD;
      z-index: -1;
    }
    
    /* Minimal background fill for safe area only */
    body::after {
      content: '';
      position: fixed;
      bottom: -40px;
      left: 0;
      right: 0;
      height: 40px;
      background: #7900FD;
      z-index: 998;
      pointer-events: none;
    }
    
    /* Add padding to body to prevent content from going under navbar */
    body {
      padding-bottom: calc(65px + env(safe-area-inset-bottom, 0px)) !important;
    }
    
    .mobile-bottom-nav a {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 4px;
      flex: 1;
      color: #ffffff;
      text-decoration: none;
      font-size: 12px;
      position: relative;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      /* Ensure clickability */
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
    }
    
    .mobile-bottom-nav a::before {
      content: '';
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 56px;
      height: 56px;
      border-radius: 16px;
      background: rgba(255, 255, 255, 0.15);
      opacity: 0;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: -1;
    }
    
    .mobile-bottom-nav a:active::before {
      opacity: 1;
      transform: translateX(-50%) scale(0.92);
    }
    
    .mobile-bottom-nav a:active {
      color: #ffffff;
      transform: translateY(-2px);
    }
    
    .mobile-bottom-nav a:active svg {
      transform: scale(0.9);
    }
    
    .mobile-bottom-nav a svg {
      flex-shrink: 0;
      width: 24px;
      height: 24px;
    }
    
    .mobile-bottom-nav a span {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
    }
    
    /* Cart Badge */
    .cart-badge {
      position: absolute;
      top: -2px;
      right: 50%;
      transform: translateX(12px);
      background: #ff4444;
      color: white;
      border-radius: 10px;
      padding: 2px 5px;
      font-size: 10px;
      font-weight: bold;
      min-width: 16px;
      height: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      line-height: 1;
    }
    
    .cart-badge.hidden {
      display: none;
    }
  }

  /* Ensure it is hidden on larger screens */
  @media screen and (min-width: 769px) {
    .mobile-bottom-nav {
      display: none;
    }
    
    body {
      padding-bottom: 0;
    }
  }
</style>

{% unless template == 'checkout' %}

  <div class="mobile-bottom-nav">
    <a href="/" title="Home">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="transform: scale(1.3);">
        <path d="M5.25 16.88V10.9146C5.25 10.3375 5.51642 9.79278 5.97193 9.4385L10.8519 5.64294C11.5272 5.11773 12.4728 5.11773 13.1481 5.64294L18.0281 9.4385C18.4836 9.79278 18.75 10.3375 18.75 10.9146V16.88C18.75 17.9128 17.9128 18.75 16.88 18.75H7.12C6.08723 18.75 5.25 17.9128 5.25 16.88Z" fill="currentColor" fill-opacity="0.1" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M14.25 14.25C14.0657 14.694 13.7535 15.0735 13.353 15.3405C12.9525 15.6075 12.4817 15.75 12 15.75C11.5183 15.75 11.0475 15.6075 10.647 15.3405C10.2465 15.0735 9.93433 14.694 9.75 14.25" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <span>Home</span>
    </a>
    
    <a href="https://bengal-mart.shop/pages/all-categories" title="Categories">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 122.88 122.54" width="23" height="23" fill="currentColor">
        <path d="M4.69,0H46.22a4.71,4.71,0,0,1,4.69,4.69V46a4.69,4.69,0,0,1-4.69,4.69H4.69a4.65,4.65,0,0,1-3.31-1.38l-.09-.09A4.67,4.67,0,0,1,0,46V4.69A4.71,4.71,0,0,1,4.69,0ZM89.44,61.94a26.56,26.56,0,0,1,10.18,2l.07,0a26.61,26.61,0,0,1,15.25,32.16,26.18,26.18,0,0,1-2.7,6.11l10.3,11.24a1.27,1.27,0,0,1-.07,1.8l-7.57,6.9a1.27,1.27,0,0,1-1.79-.07l-9.86-10.85a26.36,26.36,0,0,1-6.1,2.74,26.87,26.87,0,0,1-7.71,1.13,26.51,26.51,0,0,1-10.17-2l-.07,0A26.64,26.64,0,0,1,64.85,78.37l0-.07A26.6,26.6,0,0,1,89.44,61.94Zm15,11.59a21.38,21.38,0,0,0-6.89-4.61l-.06,0a21.22,21.22,0,0,0-23.07,4.64l-.07.07a21.25,21.25,0,0,0-4.54,6.83l0,.06a21.32,21.32,0,0,0-1.58,8.06,21.26,21.26,0,0,0,29.35,19.62,21.54,21.54,0,0,0,6.89-4.61l.07-.07a21.09,21.09,0,0,0,4.54-6.83l0-.06a21.35,21.35,0,0,0,0-16.17,21.34,21.34,0,0,0-4.62-6.9ZM4.69,63.2H46.22a4.71,4.71,0,0,1,4.69,4.7v41.34a4.68,4.68,0,0,1-4.69,4.69H4.69A4.69,4.69,0,0,1,0,109.24V67.9a4.71,4.71,0,0,1,4.69-4.7ZM68.78,0h41.53A4.71,4.71,0,0,1,115,4.69V46a4.71,4.71,0,0,1-4.69,4.69H68.78A4.71,4.71,0,0,1,64.09,46V4.69a4.69,4.69,0,0,1,1.37-3.31l.1-.09A4.67,4.67,0,0,1,68.78,0Z"/>
      </svg>
      <span>Categories</span>
    </a>

    <a href="/collections" title="Shop Under ৳500" class="featured-deal">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" color="currentColor" fill="none">
        <path d="M7.72852 15.2861H12.7285M10.2271 12.7861H10.2364M10.2294 17.7861H10.2388" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
        <path d="M6.5 3.69682C9.53332 6.78172 14.5357 0.123719 17.4957 2.53998C19.1989 3.93028 18.6605 7 16.4494 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
        <path d="M18.664 6.57831C19.6473 6.75667 19.8679 7.34313 20.1615 8.97048C20.4259 10.4361 20.5 12.1949 20.5 12.9436C20.4731 13.2195 20.3532 13.477 20.1615 13.687C18.1054 15.722 14.0251 19.565 11.9657 21.474C11.1575 22.1555 9.93819 22.1702 9.08045 21.5447C7.32407 20.0526 5.63654 18.366 3.98343 16.8429C3.3193 16.035 3.33487 14.8866 4.0585 14.1255C6.23711 11.9909 10.1793 8.33731 12.4047 6.31887C12.6278 6.1383 12.9012 6.02536 13.1942 6C13.6935 5.99988 14.5501 6.06327 15.3845 6.10896" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
      </svg>
      <span>Under ৳500</span>
    </a>
    
    <a href="/cart" title="Cart">
      <span class="cart-badge {% if cart.item_count == 0 %}hidden{% endif %}" id="mobile-cart-badge">
        {{ cart.item_count }}
      </span>
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" color="currentColor" fill="none">
        <path d="M8 7H16C17.8856 7 18.8284 7 19.4142 7.58579C20 8.17157 20 9.11438 20 11V15C20 18.2998 20 19.9497 18.9749 20.9749C17.9497 22 16.2998 22 13 22H11C7.70017 22 6.05025 22 5.02513 20.9749C4 19.9497 4 18.2998 4 15V11C4 9.11438 4 8.17157 4.58579 7.58579C5.17157 7 6.11438 7 8 7Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
        <path d="M16 9.5C16 5.63401 14.2091 2 12 2C9.79086 2 8 5.63401 8 9.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
      </svg>
      <span>Cart</span>
    </a>
  </div>
{% endunless %}

<script>
  (function() {
    // Prevent navbar from shifting on mobile browsers
    let ticking = false;
    
    function fixNavbarPosition() {
      const navbar = document.querySelector('.mobile-bottom-nav');
      if (!navbar) return;
      
      // Force navbar to stay at bottom
      navbar.style.bottom = '0';
      
      if (!ticking) {
        window.requestAnimationFrame(() => {
          navbar.style.bottom = '0';
          ticking = false;
        });
        ticking = true;
      }
    }
    
    // Fix position on scroll (iOS Safari address bar issue)
    let scrollTimeout;
    window.addEventListener('scroll', () => {
      clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(fixNavbarPosition, 50);
    }, { passive: true });
    
    // Fix position on resize (device rotation, keyboard open/close)
    window.addEventListener('resize', fixNavbarPosition, { passive: true });
    
    // Fix position on orientation change
    window.addEventListener('orientationchange', () => {
      setTimeout(fixNavbarPosition, 100);
    });
    
    // Update mobile cart badge when cart changes
    function updateMobileCartBadge() {
      fetch('/cart.js')
        .then(response => response.json())
        .then(cart => {
          const badge = document.getElementById('mobile-cart-badge');
          if (badge) {
            badge.textContent = cart.item_count;
            if (cart.item_count > 0) {
              badge.classList.remove('hidden');
            } else {
              badge.classList.add('hidden');
            }
          }
        })
        .catch(error => console.error('Error updating cart badge:', error));
    }

    // Intercept fetch requests to detect cart changes
    const originalFetch = window.fetch;
    window.fetch = function(...args) {
      const url = args[0];
      
      return originalFetch.apply(this, args).then(response => {
        // Check if it's a cart-related API call
        if (typeof url === 'string' && 
            (url.includes('/cart/add') || 
             url.includes('/cart/change') || 
             url.includes('/cart/update') ||
             url.includes('/cart/clear'))) {
          // Update badge after cart operation
          setTimeout(updateMobileCartBadge, 300);
        }
        return response;
      });
    };

    // Listen for cart updates on page load
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => {
        updateMobileCartBadge();
        fixNavbarPosition();
      });
    } else {
      updateMobileCartBadge();
      fixNavbarPosition();
    }
    
    // Listen for various cart-related events
    const cartEvents = [
      'cart:updated',
      'cart:refresh',
      'cart.requestComplete',
      'ajaxCart:added',
      'ajaxCart:updated',
      'product:added',
      'variant:add'
    ];
    
    cartEvents.forEach(event => {
      document.addEventListener(event, updateMobileCartBadge);
    });
    
    // Listen for add to cart form submissions
    document.addEventListener('submit', function(e) {
      if (e.target.matches('form[action*="/cart/add"]')) {
        setTimeout(updateMobileCartBadge, 500);
      }
    });
    
    // Listen for click events on add to cart buttons
    document.addEventListener('click', function(e) {
      const target = e.target.closest('[name="add"], .add-to-cart, .product-form__submit');
      if (target) {
        setTimeout(updateMobileCartBadge, 500);
      }
    });
    
    // Add haptic feedback for navigation taps
    document.querySelectorAll('.mobile-bottom-nav a').forEach(link => {
      link.addEventListener('touchstart', function(e) {
        // Trigger haptic feedback on supported devices
        try {
          // Try modern Vibration API (works on most devices)
          if ('vibrate' in navigator) {
            navigator.vibrate(10);
          }
          
          // Try Haptic Engine API for iOS (requires user gesture)
          if (window.webkit && window.webkit.messageHandlers && window.webkit.messageHandlers.haptic) {
            window.webkit.messageHandlers.haptic.postMessage('impact');
          }
          
          // Try alternative iOS methods
          if (window.TapticEngine) {
            window.TapticEngine.impact({style: 'light'});
          }
          
          // Audio fallback for iOS (creates a subtle "tap" feel)
          const context = new (window.AudioContext || window.webkitAudioContext)();
          const oscillator = context.createOscillator();
          const gain = context.createGain();
          
          oscillator.connect(gain);
          gain.connect(context.destination);
          
          oscillator.frequency.value = 20;
          gain.gain.setValueAtTime(0.01, context.currentTime);
          gain.gain.exponentialRampToValueAtTime(0.00001, context.currentTime + 0.01);
          
          oscillator.start(context.currentTime);
          oscillator.stop(context.currentTime + 0.01);
        } catch (error) {
          // Silently fail if haptics not supported
          console.log('Haptic feedback not available');
        }
      }, { passive: true });
    });

    // Periodic check as fallback (every 2 seconds when page is visible)
    let lastKnownCount = {{ cart.item_count }};
    setInterval(function() {
      if (!document.hidden) {
        fetch('/cart.js')
          .then(response => response.json())
          .then(cart => {
            if (cart.item_count !== lastKnownCount) {
              lastKnownCount = cart.item_count;
              updateMobileCartBadge();
            }
          });
      }
    }, 2000);
  })();
</script>

</body>
</html>